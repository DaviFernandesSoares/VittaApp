{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Meu Perfil Profissional ‚Äî Formul√°rio Multi-Etapas</title>
    <link rel="stylesheet" href="{% static 'css/standart.css' %}">
    <style>
        /* Layout baseado no seu HTML original */
        body{font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#f6f7fb; color:#1f2937; margin:0}
        .page-container{max-width:1100px;margin:28px auto;padding:0 16px}
        .profile-card{display:grid;grid-template-columns:1fr 320px;gap:24px}
        .profile-main{background:white;padding:24px;border-radius:12px;box-shadow:var(--shadow-md,0 8px 24px rgba(16,24,40,0.06))}
        .profile-aside{background:white;padding:20px;border-radius:12px;height:fit-content}

        /* Steps */
        .step{display:none}
        .step.active{display:block}
        .step-nav{display:flex;gap:8px;margin-bottom:18px;flex-wrap:wrap}
        .step-nav button{background:transparent;border:1px solid #e6e9ef;padding:8px 12px;border-radius:10px;cursor:pointer}
        .step-nav button.active{background:#4b0082;color:white;border-color:#4b0082}

        /* Form fields sizing (baseado no tamanho das caixas do seu HTML original) */
        .form-field{margin-bottom:14px;display:flex;flex-direction:column;max-width:760px}
        .form-field label{font-weight:600;margin-bottom:6px;font-size:0.95rem}
        .form-field input[type="text"],
        .form-field input[type="number"],
        .form-field input[type="email"],
        .form-field textarea,
        .form-field select{width:100%;padding:12px;border-radius:10px;border:1px solid #e6e9ef;background:#fff;font-size:0.95rem}

        /* Alturas e larguras espec√≠ficas pedidas */
        /* t√≠tulo: caixa curta */
        .field-title input{height:44px;max-width:420px}
        /* descri√ß√£o: caixa alta */
        .field-description textarea{min-height:160px;max-width:760px}
        /* √°rea de atua√ß√£o: pode ser select ou tags */
        .field-area select{height:44px;max-width:420px}
        /* endere√ßo: caixa m√©dia */
        .field-address input{height:44px;max-width:720px}
        /* valor da sess√£o: caixa curta */
        .field-price input{height:44px;width:200px}

        .book-btn{background:#4b0082;color:white;padding:10px 16px;border-radius:10px;border:none;cursor:pointer}
        .empty{color:#6b7280;padding:12px}
        .gallery img{max-width:140px;border-radius:8px;margin-right:8px}

        @media(max-width:900px){
            .profile-card{grid-template-columns:1fr;}
            .profile-aside{order:2}
        }
    </style>

</head>
<body>
<header id="navbar">
    <h1>
        <a style="color: rgba(255,255,255,0.95); text-decoration: none;"
            href="{% url 'home' %}">
            Vitta App
        </a>
    </h1>

    <nav>
    {% if not user.is_authenticated %}
        <a href="{% url 'cadastro' %}">Cadastro</a>
        <a href="{% url 'login' %}">Login</a>
    {% else %}
        <a href="{% url 'appChat:inbox' %}">Mensagens</a>

        {% if not user.tem_perfil_profissional %}
            <a href="{% url 'criar_ou_editar_perfil' %}">Criar Perfil Profissional</a>
        {% else %}
            <a href="{% url 'criar_ou_editar_perfil' %}">Gerenciar Perfil Profissional</a>
        {% endif %}

        <a href="{% url 'logout' %}">Sair</a>
    {% endif %}

    <div class="nav-search">
        <input type="text" placeholder="üîç Buscar profissional...">
    </div>
</nav>
</header>


<div class="page-container">
    <div class="profile-card">

        <div class="profile-main">
            <h2>Meu Perfil Profissional</h2>
            <p class="sub">Gerencie suas informa√ß√µes em m√∫ltiplas etapas</p>

            <form method="POST" enctype="multipart/form-data" id="multiForm">
                {% csrf_token %}

                <!-- Navega√ß√£o de etapas -->
                <div class="step-nav" id="stepNav">
                    <button type="button" class="nav-btn active" data-step="0">1. Informa√ß√µes</button>
                    <button type="button" class="nav-btn" data-step="1">2. √Årea de Atua√ß√£o</button>
                    <button type="button" class="nav-btn" data-step="2">3. T√≠tulo</button>
                    <button type="button" class="nav-btn" data-step="3">4. Descri√ß√£o</button>
                    <button type="button" class="nav-btn" data-step="4">5. Fotos</button>
                    <button type="button" class="nav-btn" data-step="5">6. Endere√ßo & Valor</button>
                    <button type="button" class="nav-btn" data-step="6">7. Revisar</button>
                </div>

                <!-- Etapa 0: Informa√ß√µes gerais (mant√©m seu form_perfil original como backup) -->
                <div class="step active" id="step0">
                    <h3 class="section-title">Informa√ß√µes Gerais</h3>
                    <div class="form-field">
                        <!-- Use os campos que j√° tiver em form_perfil, mas aqui voc√™ pode escolher quais mostrar -->
                        {{ form_perfil.nome.label_tag }}
                        {{ form_perfil.nome }}
                    </div>
                    <div class="form-field">
                        {{ form_perfil.email.label_tag }}
                        {{ form_perfil.email }}
                    </div>
                    <div>
                        <button type="button" class="book-btn" onclick="gotoStep(1)">Pr√≥ximo</button>
                    </div>
                </div>

                <!-- Etapa 1: √Årea de Atua√ß√£o -->
                <div class="step" id="step1">
                    <h3 class="section-title">√Årea de Atua√ß√£o</h3>
                    <div class="form-field field-area">
                        <label for="id_area_atuacao">√Årea de Atua√ß√£o</label>
                        <!-- se voc√™ j√° tiver um campo no form_perfil, use-o; sen√£o, mostramos um select como exemplo -->
                        {% if form_perfil.area_atuacao %}
                            {{ form_perfil.area_atuacao }}
                        {% else %}
                            <select id="id_area_atuacao" name="area_atuacao">
                                <option value="psicologia">Psicologia</option>
                                <option value="fisioterapia">Fisioterapia</option>
                                <option value="nutricao">Nutri√ß√£o</option>
                                <option value="outro">Outro</option>
                            </select>
                        {% endif %}
                    </div>
                    <div>
                        <button type="button" onclick="gotoStep(0)">Voltar</button>
                        <button type="button" class="book-btn" onclick="gotoStep(2)">Pr√≥ximo</button>
                    </div>
                </div>

                <!-- Etapa 2: T√≠tulo Profissional -->
                <div class="step" id="step2">
                    <h3 class="section-title">T√≠tulo Profissional</h3>
                    <div class="form-field field-title">
                        <label for="id_titulo">T√≠tulo</label>
                        {% if form_perfil.titulo %}
                            {{ form_perfil.titulo }}
                        {% else %}
                            <input type="text" id="id_titulo" name="titulo" placeholder="Ex: Psic√≥logo Cl√≠nico ‚Äî CRP 0/00000">
                        {% endif %}
                    </div>
                    <div>
                        <button type="button" onclick="gotoStep(1)">Voltar</button>
                        <button type="button" class="book-btn" onclick="gotoStep(3)">Pr√≥ximo</button>
                    </div>
                </div>

                <!-- Etapa 3: Descri√ß√£o -->
                <div class="step" id="step3">
                    <h3 class="section-title">Descri√ß√£o</h3>
                    <div class="form-field field-description">
                        <label for="id_descricao">Descri√ß√£o Profissional</label>
                        {% if form_perfil.descricao %}
                            {{ form_perfil.descricao }}
                        {% else %}
                            <textarea id="id_descricao" name="descricao" placeholder="Fale sobre sua experi√™ncia, abordagem e p√∫blico-alvo"></textarea>
                        {% endif %}
                    </div>
                    <div>
                        <button type="button" onclick="gotoStep(2)">Voltar</button>
                        <button type="button" class="book-btn" onclick="gotoStep(4)">Pr√≥ximo</button>
                    </div>
                </div>

                <!-- Etapa 4: Fotos (mantemos seu form_imagem) -->
                <div class="step" id="step4">
                    <h3 class="section-title">Fotos</h3>
                    <div class="form-field">
                        {{ form_imagem.as_p }}
                    </div>
                    <div>
                        <button type="button" onclick="gotoStep(3)">Voltar</button>
                        <button type="button" class="book-btn" onclick="gotoStep(5)">Pr√≥ximo</button>
                    </div>
                </div>

                <!-- Etapa 5: Endere√ßo e Valor da Sess√£o -->
                <div class="step" id="step5">
                    <h3 class="section-title">Endere√ßo & Valor da Sess√£o</h3>
                    <div class="form-field field-address">
                        <label for="id_endereco">Endere√ßo (local de atendimento)</label>
                        {% if form_perfil.endereco %}
                            {{ form_perfil.endereco }}
                        {% else %}
                          <input type="text" id="id_endereco" name="endereco" placeholder="Rua, n√∫mero, bairro ‚Äî Cidade/UF">
                        {% endif %}
                    </div>
                    <div class="form-field field-price">
                        <label for="id_valor">Valor da Sess√£o (R$)</label>
                        {% if form_perfil.valor_sessao %}
                            {{ form_perfil.valor_sessao }}
                        {% else %}
                            <input type="number" id="id_valor" name="valor_sessao" step="0.01" placeholder="Ex: 150.00">
                        {% endif %}
                    </div>
                    <div>
                        <button type="button" onclick="gotoStep(4)">Voltar</button>
                        <button type="button" class="book-btn" onclick="gotoStep(6)">Pr√≥ximo</button>
                    </div>
                </div>

                <!-- Etapa 6: Revisar e Salvar -->
                <div class="step" id="step6">
                    <h3 class="section-title">Revisar Informa√ß√µes</h3>
                    <p class="sub">Confira os dados antes de salvar. (Aqui voc√™ pode renderizar um resumo usando os valores enviados ou os campos do form.)</p>

                    <!-- Exemplo de resumo est√°tico; ideal: preencher via JS lendo os campos reais -->
                    <div class="form-field">
                        <strong>Nome:</strong> <span id="preview_nome">{{ form_perfil.nome.value }}</span>
                    </div>
                    <div class="form-field">
                        <strong>√Årea:</strong> <span id="preview_area">{{ form_perfil.area_atuacao.value }}</span>
                    </div>
                    <div class="form-field">
                        <strong>T√≠tulo:</strong> <span id="preview_titulo">{{ form_perfil.titulo.value }}</span>
                    </div>
                    <div class="form-field">
                        <strong>Descri√ß√£o:</strong> <div id="preview_descricao">{{ form_perfil.descricao.value }}</div>
                    </div>
                    <div class="form-field">
                        <strong>Endere√ßo:</strong> <span id="preview_endereco">{{ form_perfil.endereco.value }}</span>
                    </div>
                    <div class="form-field">
                        <strong>Valor:</strong> <span id="preview_valor">{{ form_perfil.valor_sessao.value }}</span>
                    </div>

                    <div>
                        <button type="button" onclick="gotoStep(5)">Voltar</button>
                        <button type="submit" class="book-btn">Salvar</button>
                    </div>
                </div>

            </form>

            {% if imagens %}
                <h3 class="section-title">Pr√©-visualiza√ß√£o</h3>
                <div class="gallery">
                    {% for img in imagens %}
                        <img src="{{ img.imagem.url }}" alt="Imagem {{ forloop.counter }}">
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty">Nenhuma imagem enviada ainda.</div>
            {% endif %}
        </div>

    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    // Navega√ß√£o entre etapas
    const steps = Array.from(document.querySelectorAll('.step'));
    const navBtns = Array.from(document.querySelectorAll('.nav-btn'));
    let current = 0;

    function setActive(n){
        steps.forEach((s,i)=> s.classList.toggle('active', i===n));
        navBtns.forEach((b,i)=> b.classList.toggle('active', i===n));
        current = n;
    }

    function gotoStep(n){
        if (typeof n !== 'number') n = parseInt(n, 10);
        if (isNaN(n) || n<0||n>=steps.length) return;
        setActive(n);

        // atualiza preview imediatamente ao entrar na etapa 6 (Revisar)
        if (n === 6) updatePreview();
    }

    navBtns.forEach(btn=> btn.addEventListener('click', ()=> gotoStep(Number(btn.dataset.step))));

    // Atualiza preview lendo campos de forma tolerante (id ou name)
    function readField(id, name){
        let el = null;
        if (id) el = document.getElementById(id);
        if (!el && name) el = document.querySelector('[name="'+name+'"]');
        if (!el) return '';
        // para selects e inputs/textarea
        return (el.options ? (el.selectedOptions[0] ? el.selectedOptions[0].textContent : el.value) : el.value) || '';
    }

    function updatePreview(){
        try{
            // tenta id primeiro, depois name ‚Äî ajuste os nomes conforme seus fields reais
            document.getElementById('preview_nome').textContent = readField('id_nome', 'nome');
            document.getElementById('preview_area').textContent = readField('id_area_atuacao', 'area_atuacao');
            document.getElementById('preview_titulo').textContent = readField('id_titulo', 'titulo');
            document.getElementById('preview_descricao').textContent = readField('id_descricao', 'descricao');
            document.getElementById('preview_endereco').textContent = readField('id_endereco', 'endereco');
            document.getElementById('preview_valor').textContent = readField('id_valor', 'valor_sessao');
        }catch(e){
            console.warn('Erro ao atualizar preview:', e);
        }
    }

    // Se voc√™ quiser atualizar o preview ao sair de um campo (opcional)
    // adiciona listeners aos inputs importantes para manter o preview sempre atualizado
    const watchNames = ['id_nome','id_area_atuacao','id_titulo','id_descricao','id_endereco','id_valor'];
    watchNames.forEach(id=>{
        const el = document.getElementById(id);
        if (el){
            el.addEventListener('input', ()=> { if (current===6) updatePreview(); });
            el.addEventListener('change', ()=> { if (current===6) updatePreview(); });
        }
    });

    // inicializa (garante que a etapa 0 esteja ativa)
    setActive(0);

    // menu de usu√°rio (se existir)
    const menu = document.querySelector(".user-menu");
    const btn = document.querySelector(".circle-btn");
    if (btn && menu) {
        btn.addEventListener("click", (ev) => {
            ev.stopPropagation();
            menu.classList.toggle("active");
        });

        // Fecha quando clicar fora
        document.addEventListener("click", (e) => {
            if (!menu.contains(e.target)) {
                menu.classList.remove("active");
            }
        });
    }
});
</script>


</body>
</html>