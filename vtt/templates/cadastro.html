{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cadastro — Vitta App</title>
  <link rel="stylesheet" href="{% static 'css/standart.css' %}">
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
</head>
<body>

<header id="navbar" aria-hidden="true">
   <h1> <a style="color: rgba(255,255,255,0.95);text-decoration: none; " href="{% url 'home' %}" >Vitta App</a></h1>
</header>


  <main class="page-container" role="main">
    <div class="profile-card" aria-labelledby="cadastro-title">
      <div class="profile-main">
        <div class="meta-row" style="align-items:center; gap:12px; margin-bottom:10px;">
          <div class="badge-area" aria-hidden="true" style="display:inline-flex; align-items:center; gap:10px;">
            <div style="width:52px; height:52px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-weight:800; color:#fff; background:linear-gradient(135deg,var(--primary),var(--accent));">VA</div>
            <div>
              <h2 id="cadastro-title">Crie sua conta</h2>
              <div class="sub">Rápido e seguro — gerencie agendamentos e acesso a serviços</div>
            </div>
          </div>
        </div>

        <form id="cadastroForm"
              action="{% url 'cadastro' %}"
              method="post"
              hx-post="{% url 'cadastro' %}"
              hx-target="#mensagem"
              hx-swap="innerHTML"
              novalidate>

          {% csrf_token %}

          <div class="input-box">
            <span class="icon" aria-hidden="true"><ion-icon name="person-circle-outline"></ion-icon></span>
           <input type="text" id="full_name" name="full_name">
            <label for="full_name">Nome completo</label>
            <div id="nome-erro" class="error-tooltip" aria-live="polite"></div>
          </div>

          <div class="input-box">
            <span class="icon" aria-hidden="true"><ion-icon name="mail-outline"></ion-icon></span>
            <input type="email" id="email" name="email" required autocomplete="email" />
            <label for="email">Email</label>
            <div id="email-erro" class="error-tooltip" aria-live="polite"></div>
          </div>
          <div class="input-box">
            <span class="icon" aria-hidden="true"><ion-icon name="lock-closed-outline"></ion-icon></span>
            <input type="password" id="password" name="password" required minlength="6" autocomplete="new-password" />
            <label for="password">Senha</label>
            <div id="senha-erro" class="error-tooltip" aria-live="polite"></div>
          </div>

          <div class="show-password-container">
            <input type="checkbox" id="show-password">
            <label for="show-password">Mostrar senha</label>
          </div>

          <button type="submit" class="book-btn" id="submit-btn">Criar conta</button>

          <div id="mensagem" class="empty" style="display:none; margin-top:12px;"></div>

          <div class="login-register" style="margin-top:12px; text-align:center;">
            <p class="no-break">Já tem conta? <a href="{% url 'login' %}">Entrar</a></p>
          </div>
        </form>

      </div>
    </div>
  </main>

  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

  <script>
    // comportamento: mostrar/ocultar senha, validação mínima e integração HTMX
    (function () {
      const form = document.getElementById('cadastroForm');
      const pwd = document.getElementById('password');
      const show = document.getElementById('show-password');
      const mensagem = document.getElementById('mensagem');
      const submitBtn = document.getElementById('submit-btn');

      show.addEventListener('change', () => {
        pwd.type = show.checked ? 'text' : 'password';
      });

      form.addEventListener('submit', (e) => {
        mensagem.style.display = 'none';
        mensagem.textContent = '';

        let valid = true;
        const nome = document.getElementById('full_name').value || '';
        const email = document.getElementById('email').value || '';
        if (!nome.trim()) {
          document.getElementById('nome-erro').textContent = 'Informe seu nome';
          valid = false;
        } else {
          document.getElementById('nome-erro').textContent = '';
        }
        if (!email.trim()) {
          document.getElementById('email-erro').textContent = 'Informe seu email';
          valid = false;
        } else {
          document.getElementById('email-erro').textContent = '';
        }
        if ((pwd.value || '').length < 6) {
          document.getElementById('senha-erro').textContent = 'Senha deve ter pelo menos 6 caracteres';
          valid = false;
        } else {
          document.getElementById('senha-erro').textContent = '';
        }

        if (!valid) {
          e.preventDefault();
          return;
        }

        // desativa botão até resposta do servidor
        submitBtn.disabled = true;
      });

      // mostra a mensagem retornada pelo servidor via HTMX
      document.body.addEventListener('htmx:afterSwap', (e) => {
        if (e.detail && e.detail.target && e.detail.target.id === 'mensagem') {
          mensagem.style.display = 'block';
          submitBtn.disabled = false;
        }
      });
    })();
  </script>
</body>
</html>