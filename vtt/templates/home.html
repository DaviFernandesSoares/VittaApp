{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Vitta App - Home</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
     <link rel="stylesheet" href="{% static 'css/standart.css' %}">
</head>
<body>

<header id="navbar">
    <h1> <a style="color: rgba(255,255,255,0.95);text-decoration: none; " href="{% url 'home' %}" >Vitta App</a></h1>
     <nav>
    {% if not user.is_authenticated %}
        <a href="{% url 'cadastro' %}">Cadastro</a>
        <a href="{% url 'login' %}">Login</a>
    {% else %}
        <a href="{% url 'appChat:inbox' %}">Mensagens</a>

        {% if not user.tem_perfil_profissional %}
            <a href="{% url 'criar_ou_editar_perfil' %}">Criar Perfil Profissional</a>
        {% else %}
            <a href="{% url 'criar_ou_editar_perfil' %}">Gerenciar Perfil Profissional</a>
        {% endif %}

        <a href="{% url 'logout' %}">Sair</a>
    {% endif %}

    <div class="nav-search">
        <input type="text" placeholder="üîç Buscar profissional...">
    </div>
</nav>
</header>

<!-- Barra de busca principal (mesma l√≥gica) -->
<div class="search-bar" id="mainSearch">
    <form method="get" action="{% url 'home' %}">
        <input type="text" name="q" placeholder="üîç Busque seu profissional" value="{{ request.GET.q|default:'' }}">
    </form>
</div>

<!-- chips de √°rea (mesma l√≥gica) -->
<div class="chips">
    <a href="{% url 'home' %}" class="chip {% if not request.GET.area %}active{% endif %}">Todas</a>
    {% for nome, count in areas %}
        <a href="?area={{ nome }}" class="chip {% if request.GET.area == nome %}active{% endif %}">{{ nome }} ({{ count }})</a>
    {% endfor %}
</div>

<!-- Profissionais agrupados por √°rea (l√≥gica id√™ntica) -->
<div class="container-custom">
    {% regroup perfis.object_list by area_atuacao.nome as areas_grouped %}
    {% for grupo in areas_grouped %}
        <div class="section-title">
            <div style="display:flex; flex-direction:column;">
                <strong style="font-size:16px;">{{ grupo.grouper|default:"Outros" }}</strong>
                <small style="color:var(--muted);">{{ grupo.list|length }} profissionais</small>
            </div>
        </div>

        <div class="row-cards">
            {% for perfil in grupo.list %}
                <div class="d-flex-card">
                    <a href="{% url 'perfil_detalhe' perfil.id %}" class="card-prof" aria-label="Perfil de {{ perfil.usuario.name }}">
                        {% with img=perfil.imagens.first %}
                            {% if img %}
                                <img class="card-media" src="{{ img.imagem.url }}" alt="{{ perfil.usuario.name }}" loading="lazy">
                            {% else %}
                                <img class="card-media" src="https://via.placeholder.com/800x600?text=Sem+imagem" alt="Sem imagem" loading="lazy">
                            {% endif %}
                        {% endwith %}
                        <div class="card-body">
                            <h5>{{ perfil.usuario.name }}</h5>
                            <p>{{ perfil.titulo }}</p>

                            <div class="card-footer">
                                <div class="area">{{ perfil.area_atuacao.nome|default:"Geral" }}</div>
                                <div style="text-align:right;">
                                    <div class="valor">R$ {{ perfil.valor_por_sessao|default:"80,00" }}/h</div>
                                    <div style="color:var(--muted); font-size:13px;">‚≠ê {{ perfil.avaliacao_media|default:"5.0" }}</div>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            {% empty %}
                <div class="empty">Nenhum profissional nesta √°rea.</div>
            {% endfor %}
        </div>
    {% empty %}
        <p class="text-center text-muted mt-5">Nenhum profissional encontrado.</p>
    {% endfor %}

    <!-- pagina√ß√£o (mesma l√≥gica) -->
    <div class="pagination-center">
        <nav aria-label="Pagina√ß√£o">
            <ul class="pagination">
                {% if perfis.has_previous %}
                    <li class="page-item"><a class="page-link" href="?page={{ perfis.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.area %}&area={{ request.GET.area }}{% endif %}">Anterior</a></li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">Anterior</span></li>
                {% endif %}

                <li class="page-item disabled"><span class="page-link">P√°gina {{ perfis.number }} de {{ perfis.paginator.num_pages }}</span></li>

                {% if perfis.has_next %}
                    <li class="page-item"><a class="page-link" href="?page={{ perfis.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.area %}&area={{ request.GET.area }}{% endif %}">Pr√≥xima</a></li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">Pr√≥xima</span></li>
                {% endif %}
            </ul>
        </nav>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const navbar = document.getElementById('navbar');
    const searchBar = document.getElementById('mainSearch');

    window.addEventListener('scroll', () => {
        if (window.scrollY > 80) {
            navbar.classList.add('shrink');
            searchBar.classList.add('hide');
        } else {
            navbar.classList.remove('shrink');
            searchBar.classList.remove('hide');
        }
    });
</script>

</body>
</html>

